:: Widgets trNPCdesc [widget nobr]
<<widget "trNPCdesc">><<silently>>
    <<trinit_NPCdescAdj>>
    <<trinit_namedNPC>>
    <<trinit_beastsList>>
	<<trinit_beastAdjList>>
	<<trinit_genderNoun>>
	<<trinit_roleList>>
    <<set _trResult to undefined>>
    
    <<if typeof $args[0] is "string">>
        <<set _tempArray to $args[0].split(' ')>>
			/* namedNPC? */
			<<if _namedNPCList.find(function(select){
				if(select.name  == $args[0]){
					return true;
				} else if (Array.isArray(select.title)){
					if (select.title.includes($args[0])){return true;}
				} else if (select.title == $args[0]) {
					return true;
				}
			}) isnot undefined>>
            <<trNamedNPC $args[0] $args[1] $args[2]>>
        <</if>>
		/* beast? */
        <<if _trResult is undefined>>
            <<for $_i to 0; $_i lt _tempArray.length; $_i++>>
                <<if _beasttypeList.hasOwnProperty(_tempArray[$_i])>>
                    <<trBeastdesc $args[0] $args[1] $args[2]>>
                    <<break>>
                <</if>>
            <</for>>
        <</if>>

		/* Adjective + genderNoun? */
        <<if _trResult is undefined>>
            <<if _NPCdescList[_tempArray[0]] isnot undefined>>
                <<set _trResult to _NPCdescList[_tempArray[0]]>>
            <<elseif _beastAdjList[_tempArray[0]] isnot undefined>>
				<<set _trResult to _beastAdjList[_tempArray[0]]>>
			<<else>>
                <<if _tempArray[0] is undefined>>
                    <<set _trResult to "">>
                <<else>>
                    <<set _trResult to _tempArray[0]>>
                <</if>>
            <</if>>
			
			<<if _trResult isnot undefined and _tempArray.length gte 3>>
				/* ex: minor demon */
				<<if _NPCdescList[_tempArray[1]] isnot undefined>>
					<<set _trResult += " "+_NPCdescList[_tempArray[1]]>>
					<<set _tempArray.deleteAt(0)>>
				<</if>>
			<</if>>

			<<set $_found to _trRoleList[_tempArray[1]]>>
			<<if $_found is undefined>>
				<<set $_found to _genderList[_tempArray[1]]>>
			<</if>>

            <<if $_found isnot undefined>>
                <<if _tempArray[0] is undefined>>
                    <<set _trResult to $_found.ko>>
                <<else>>
                    <<set _trResult += " "+$_found.ko>>
                <</if>>
                <<if $args[1] isnot undefined>>
                    <<trPost $_found.post $args[1] $args[2]>>
                <</if>>
            <</if>>
        <</if>>
    <</if>>

    <<if _trResult is undefined>>
        <<if $args[0] is undefined>>
            <<set _trResult to "">>
        <<else>>
            <<set _trResult to "trNPCdesc에서 찾지 못함:" +$args[0]>>
        <</if>>
    <</if>>
<</silently>><</widget>>

<<widget "trNPCname">><<silently>>
	<<if $args[0] is undefined>>
		<<set $_name to $NPCList[0].name>>
	<<elseif typeof $args[0] is "string">>
		<<set $_name to $args[0]>>
	<<elseif typeof $args[0] is "number">>
		<<set $_name to $NPCList[Number($args[0])].name>>
	<<else>>
		<<set $_name to $args[0][0]>>
	<</if>>
	
	<<trinit_NPCname>> /* 대신 trNPCdesc에 맡겨버릴까? */
	<<set $_found to _trNPCnameList[$_name]>>
	<<if $_found is undefined>>
		<<trinit_namedNPC>>
		<<set $_found to _namedNPCList.find(function(select){
			if(select.name == $_name){
				return true;
			}
		})>>
	<</if>>
	<<if $_found is undefined>> /* 대신 trNPCdesc에 맡겨버릴까? */
		<<set $_found to {}>>
		<<set $_found.koname to $_name>>
		<<getPostNum $_name>>
		<<set $_found.post to _postNum>>
	<</if>>
	
	<<set _trResult to $_found.koname>>
	<<if $args[1] isnot undefined>>
		<<trPost $_found.post $args[1] $args[2]>>
	<</if>>
<</silently>><</widget>>